<head xmlns="http://www.w3.org/1999/html" xmlns:style="http://www.w3.org/1999/xhtml">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <title>{% block title %}Guestbook{% endblock %}</title>

    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
          integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css?family=Dancing+Script" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
    <link href="style.css" rel="stylesheet" type="text/css"/>
    <h1><a href="posts.php">Guestbook</a></h1>

</head>
<body>
<div class="container">

        {% if result_add_post %}
            <div class="alert alert-success" role="alert">
                Post added!
            </div>
        {% elseif email_validation == false and result_add_post == false and is_post_add == true %}
            <div class="alert alert-danger" role="alert">
                Email is invalid. Please enter a valid email.
            </div>
        {% elseif email_validation == true and result_add_post == false and is_post_add == true %}
            <div class="alert alert-danger" role="alert">
                You did not enter in all the required information!
            </div>
        {% elseif result_delete_post %}
            <div class="alert alert-success" role="alert">
                Post deleted!
            </div>
        {% elseif result_delete_post == false and is_post_delete == true %}
            <div class="alert alert-danger" role="alert">
                Post not deleted!
            </div>
        {% elseif result_edit_post %}
            <div class="alert alert-success" role="alert">
                Post edited!
            </div>
        {% elseif result_edit_post == false and is_post_edit == true %}
            <div class="alert alert-danger" role="alert">
                Post not edited! Please fill in all the required information.
            </div>
        {% endif %}

    <div id="col1">
        <h2 >Hello, {{ fName }} {{ lName }}!
            <a class="signout" style=" font-size: 11px; color: blue" href="logout.php" >Sign Out</a></h2>
        <hr/>
        {# form to add post to guestbook #}
        <form id="posts" action="posts.php" method='post'>
            <table>
                <tr>
                    <td>Message: </td>
                </tr>
                <tr>
                    <td><textarea name='message' style='width: 350px; height: 100px;'
                                  placeholder="Write your message here.."></textarea></td>
                </tr>
                <tr>

                    <td> <button name='postbtn'>Post</button></td>
                </tr>
            </table>
        </form>
    </div>

    <div id="col2">
        <div id="posts_list">
            <h2>Current Posts</h2>
            {% if num_rows > 0 %}
                <hr/>
                    {% for i in range(0, row_limit_pagination-1) %}

                        {# display posts, edit & delete btn #}
                        <div><form action="posts.php" method="post">
                            <div class="action-button">
                                <button name='editbtn'>Edit</button>
                                <button class="deletebtn" name='deletebtn' style="display: block; margin-right: 4px">Delete</button>
                            </div>
                            By <b>{{ row[i].name }}</b> - at <b>{{ row[i].time }}</b> on
                                <b>{{ row[i].date }} </b>
                            <input type='text' name='message' value='{{ row[i].message }}'/>
                            <input type='hidden' name='id' value='{{ row[i].id }}'/></form>
                        </div><hr/>

                {% endfor %}
            {% endif %}

            <nav aria-label="Page navigation example">
                <ul class="pagination justify-content-end">
                    {% if page == 1 %}
                        <li class="page-item disabled">
                            <a class="page-link" href="#" tabindex="-1">Previous</a>
                        </li>
                    {% else %}
                        <li class="page-item">
                            <a class="page-link" href="posts.php?page={{ page-1 }}">Previous</a>
                        </li>
                    {% endif %}

                    {% set currentPage = page %}
                    {% for page in range (1, num_of_pages) %}
                        {% if page == currentPage %}
                        <li class="page-item active">
                            <a class="page-link" href="posts.php?page={{ page }}">
                                {{ page }}<span class="sr-only">(current)</span></a>
                        </li>
                        {% else %}
                        <li class="page-item"><a class="page-link" href="posts.php?page={{ page }}">
                                {{ page }}</a></li>
                        {% endif %}
                    {% endfor %}



                    {% if page == num_of_pages %}
                        <li class="page-item disabled">
                            <a class="page-link" href="#" tabindex="-1">Next</a>
                        </li>
                    {% else %}
                        <li class="page-item">
                            <a class="page-link" href="posts.php?page={{ page+1 }}">Next</a>
                        </li>
                    {% endif %}
                </ul>
            </nav>
        </div>
    </div>
</div>

<script type="text/javascript">
    $(function(){
       $('.deletebtn').on('click', function (e) {
           let status = confirm('Are you sure you want to delete this post?');
           if (!status){
               e.preventDefault();
               return false;
           }
       })
    });
</script>

<script type="text/javascript">
    $(function(){
        $('.signout').on('click', function (e) {
            let status = confirm('Are you sure you want to sign out?');
            if (!status){
                e.preventDefault();
                return false;
            }
        })
    });
</script>

</body>
<footer>
    Total posts: {{ num_rows }}
</footer>